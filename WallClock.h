/* WallClock.h
 * 
 * Author           : Alexander J. Yee
 * Date Created     : 11/18/2010
 * Last Modified    : 11/18/2010
 * 
 * 
 * 
 *      Portable Wall Clock
 * 
 */

#pragma once
#ifndef _WallClock_H
#define _WallClock_H
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  Windows
#ifdef _WIN32
#include <time.h>
typedef struct{
    clock_t val;
} wallclock;
wallclock wc_now(){
    wallclock wc;
    wc.val = clock();
    return wc;
}
double wc_time_since(wallclock start){
    wallclock now = wc_now();
    return (double)(now.val - start.val) / CLOCKS_PER_SEC;
}

////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  Linux
#else
#include <sys/time.h>
typedef struct{
    struct timeval val;
} wallclock;
wallclock wc_now(){
    wallclock wc;
    gettimeofday(&wc.val,NULL);
    return wc;
}
double wc_time_since(wallclock start){
    wallclock now = wc_now();
    unsigned long long isec = (unsigned long long)now.val.tv_sec - (unsigned long long)start.val.tv_sec;
    int usec = now.val.tv_usec - start.val.tv_usec;
    if (usec < 0){
        usec += 1000000;
        isec--;
    }
    return (double)isec + (double)usec * .000001;
}
#endif
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#endif
